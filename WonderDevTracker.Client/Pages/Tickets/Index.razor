@* TicketsIndex *@
@page "/tickets"
@attribute [Authorize]

@inject ITicketDTOService ticketService
@inject ISnackbar Snackbar

@inherits AuthenticatedComponentBase

<PageTitle>Open Tickets | Dev Tracker</PageTitle>
<MudContainer MaxWidth="MaxWidth.Large" Class="py-4 page-container" Style="height: 100%; position: relative">
	<MudBreadcrumbs Items="breadcrumbs" Class="breadcrumbs1" />
	@if (!_loadingComplete)
	{
		<LoadingSpinner Message="Loading open tickets ..." Color="Color.Primary" Size="Size.Large" />
	}
	else if (tickets.Any())
	{
		<MudText Typo = "Typo.h3" GutterBottom > Open Tickets </MudText >
		<TicketsTable Tickets="tickets" />
	}
	else
	{
		<NotFoundFull Message="No open tickets found."
					  ReturnUrl="/"
					  ReturnLabel="Home"
					  ForwardUrl="/tickets/create"
					  ForwardLabel="Create New Ticket" />
	}

</MudContainer>


@code {
	private IEnumerable<TicketDTO> tickets = [];

	private bool _loadingComplete = false;

	protected override async Task OnInitializedWithAuthAsync()
	{
		try
		{
			tickets = await ticketService.GetOpenTicketsAsync(UserInfo!);

		}
		catch (Exception ex)
		{

			Console.WriteLine($"Error loading tickets: {ex.Message}");
			Snackbar.Add("Error loading tickets.", Severity.Error);
		}
		_loadingComplete = true;

	}


	private static readonly List<BreadcrumbItem> breadcrumbs = new()
	{
		new BreadcrumbItem("Home", href:"/" ),
		new BreadcrumbItem("Tickets", href:"/tickets" ),
		new BreadcrumbItem(" Open Tickets", href:null, disabled: true ),

	};


}
