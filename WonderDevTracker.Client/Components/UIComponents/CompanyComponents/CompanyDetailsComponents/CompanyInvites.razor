@*CompanyInvites *@
@inherits AuthenticatedComponentBase

<AnimatedCard Index="Index"
			  Class="p-3 mb-3 w-100">
	@if (!Invites.Any())
	{
		<MudCardHeader>
			<CardHeaderContent>
				<MudText Typo="Typo.h2" Color="Color.Primary">Invitations</MudText>
				<MudDivider />
			</CardHeaderContent>
		</MudCardHeader>
		<MudCardContent>
			<NotFoundDisplay Message="No invitations found for this company." />
		</MudCardContent>
	}
	else
	{
		<MudTabs Elevation="0" Rounded="true" >
			<MudTabPanel Text="Pending Invites">
				<CompanyInviteTable Invites="@PendingInvites" />
			</MudTabPanel>
			<MudTabPanel Text="Accepted Invites">
				<CompanyInviteTable Invites="@AcceptedInvites" />
			</MudTabPanel>
			<MudTabPanel Text="Cancelled/Expired Invites">
				<CompanyInviteTable Invites="@CancelledInvites" />

			</MudTabPanel>
		</MudTabs>
	}
	@if (IsAdmin)
	{
		<SafeNavButton Valid="true"
					   Color="Color.Tertiary"
					   Variant="Variant.Text"
					   Size="Size.Medium"
					   Class="project-details-link me-auto mt-2"
					   StartIcon="@Icons.Material.Filled.PersonAdd"
					   TypeText="Invite New Member"
					   Href="/company/invite" />
	}
	</AnimatedCard>
@code {
	#region PARAMETERS
	[Parameter, EditorRequired]
	public int Index { get; set; }

	[Parameter]
	public CompanyDTO? Company { get; set; }


	[Parameter, EditorRequired]
	public IEnumerable<InviteDTO> Invites { get; set; } = [];
	#endregion

	#region STATE

	#endregion
	#region COMPUTED PROPERTIES
	private IEnumerable<InviteDTO> PendingInvites => Invites.Where(i => i.IsValid == true
															 && !i.JoinDate.HasValue
															 && string.IsNullOrEmpty(i.InviteeId));
	private IEnumerable<InviteDTO> AcceptedInvites => Invites.Where(i => i.JoinDate.HasValue
															  || !string.IsNullOrEmpty(i.InviteeId));
	private IEnumerable<InviteDTO> CancelledInvites => Invites.Where(i => i.IsValid == false
															  && !i.JoinDate.HasValue);
	#endregion
}
