@* ProjectTickets *@
<AnimatedCard Index="Index">
    <MudCardHeader>
        <MudText Typo="Typo.h3" Color="Color.Primary">Project Tickets</MudText>
    </MudCardHeader>
    <MudCardContent>
        @if (Project.Tickets is null)
        {
            <NotFoundDisplay Message="No tickets assigned to this project." />

        }
        else
        {
            <MudTabs Elevation="0" Rounded="true" ApplyEffectsToContainer="true" PanelClass="pa-6">
                <MudTabPanel Text="Open Tickets">
                    @if (Project.Archived)
                    {

                        <ProjectTicketTable Tickets="@OpenWhenArchivedTickets" />
                    }
                    else
                    {
                        <ProjectTicketTable Tickets="@OpenTickets" />

                    }
                </MudTabPanel>
                <MudTabPanel Text="Resolved Tickets">
                    <ProjectTicketTable Tickets="@ResolvedTickets" />
                </MudTabPanel>
                <MudTabPanel Text="Archived Tickets">
                    <ProjectTicketTable Tickets="@ArchivedTickets" />

                </MudTabPanel>
            </MudTabs>
        }

    </MudCardContent>
</AnimatedCard>
@code {
    [Parameter, EditorRequired]
    public ProjectDTO Project { get; set; } = default!;

    [Parameter, EditorRequired]
    public int Index { get; set; }

    //Active open tickets associated with the project
    private IEnumerable<TicketDTO> OpenTickets => Project.Tickets.Where(t => !t.Archived && t.Status != TicketStatus.Resolved);
    // These are open tickets that were not resolved at the time its associated project was archived(AKA ArchivedByProject = true)
    private IEnumerable<TicketDTO> OpenWhenArchivedTickets => Project.Tickets.Where(t => t.ArchivedByProject && t.Status != TicketStatus.Resolved);

    private IEnumerable<TicketDTO> ResolvedTickets => Project.Tickets.Where(t => (Project.Archived ? t.ArchivedByProject : !t.Archived) && t.Status == TicketStatus.Resolved);
    private IEnumerable<TicketDTO> ArchivedTickets => Project.Tickets.Where(t => Project.Archived ? !t.ArchivedByProject : t.Archived);
}
